<div class="board-games-individual-container" [class.dark-mode]="isDarkMode">
  <div class="header-section">
    <h1>Board Games (Game View)</h1>
    <div class="header-buttons">
      <button 
        *ngIf="isMassEditMode && hasSelectedBoardGames()" 
        type="button" 
        class="mass-edit-button" 
        (click)="startMassEdit()">
        Mass Edit ({{selectedBoardGames.size}})
      </button>
      <button type="button" class="filter-button" (click)="openFilterModal()">
        Filter
      </button>
    </div>
  </div>

  <div class="content-section">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-message">
      <p>Loading board games...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="error-message">
      <p>{{errorMessage}}</p>
    </div>

    <!-- Board Games List -->
    <div *ngIf="!isLoading && !errorMessage" class="board-games-list">
      <!-- Filter Status -->
      <div *ngIf="filterService.hasActiveFilters('boardGame')" class="filter-status">
        <div class="filter-info">
          <span class="filter-label">Filtered by:</span>
          <span class="filter-value">{{getActiveFilterDisplayText()}}</span>
          <button type="button" class="clear-filter-button" (click)="clearFilters()">
            Clear Filter
          </button>
        </div>
      </div>
      
      <div *ngIf="boardGames.length === 0 && !filterService.hasActiveFilters('boardGame')" class="empty-state">
        <p>No Board Games data found.<br><br>
            This is a list of all of the Board Games in your collection, not the games as they appear on your shelf in boxes but the list of games not including expansions or repeats.<br><br>
            Board Games are created through creating Board Game Boxes, go to the <button type="button" class="link-button" (click)="navigateToShelfView()">Shelf View</button> to create your first Board Game Box or go to the <button type="button" class="link-button" (click)="navigateToOptions()">Options</button> page and use the buttons at the bottom to import data.</p>
      </div>

      <div *ngIf="boardGames.length === 0 && filterService.hasActiveFilters('boardGame')" class="no-games-message">
        <p>No board games found.</p>
      </div>
      
      <div *ngIf="boardGames.length > 0" class="table-container">
        <div class="table-header">
          <span class="item-count">{{boardGamesCount}} {{boardGamesCount === 1 ? 'Board Game' : 'Board Games'}}</span>
        </div>
        <div class="table-wrapper">
          <table class="board-games-table">
          <thead>
            <tr>
              <th *ngIf="isMassEditMode" class="edit-column-header">
                <input 
                  type="checkbox" 
                  [checked]="isAllBoardGamesSelected()"
                  [indeterminate]="isSomeBoardGamesSelected()"
                  (change)="toggleAllBoardGames()"
                  class="edit-checkbox select-all-checkbox">
              </th>
              <th>Title</th>
              <th *ngFor="let fieldName of customFieldNames" class="custom-field-header">{{fieldName}}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let game of boardGames" class="table-row">
              <td *ngIf="isMassEditMode" class="edit-checkbox-cell" (click)="$event.stopPropagation()">
                <input 
                  type="checkbox" 
                  [checked]="isBoardGameSelected(game.id)"
                  (click)="toggleBoardGameSelection(game.id, $event)"
                  class="edit-checkbox">
              </td>
              <td class="game-title" (click)="navigateToBoardGameDetail(game)">{{game.title}}</td>
              <td *ngFor="let fieldName of customFieldNames" class="custom-field-value" (click)="navigateToBoardGameDetail(game)">
                <app-boolean-display 
                  *ngIf="shouldDisplayBooleanBadge(game, fieldName)"
                  [value]="getCustomFieldValue(game, fieldName)"
                  size="small">
                </app-boolean-display>
                <span *ngIf="shouldDisplayCustomField(game, fieldName)">
                  {{getCustomFieldValue(game, fieldName)}}
                </span>
              </td>
            </tr>
          </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Detail Board Game Modal -->
  <div *ngIf="showDetailBoardGameModal" class="modal-overlay" (click)="closeDetailBoardGameModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{selectedBoardGame?.title}} Details</h2>
        <div class="modal-header-actions">
          <button type="button" class="close-button" (click)="closeDetailBoardGameModal()">×</button>
        </div>
      </div>
      
      <div class="modal-body" *ngIf="selectedBoardGame">
        <!-- Custom Fields -->
        <div class="custom-fields-inline" *ngIf="hasDisplayableCustomFields(selectedBoardGame)">
          <div class="detail-grid">
            <div class="detail-item" *ngFor="let field of selectedBoardGame.customFieldValues" [hidden]="!shouldDisplayCustomFieldInModal(field)">
              <label>{{field.customFieldName}}:</label>
              <app-boolean-display 
                *ngIf="field.customFieldType === 'boolean'; else textValue"
                [value]="field.value"
                size="small">
              </app-boolean-display>
              <ng-template #textValue>
                <span>{{field.value}}</span>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Board Game Modal -->
  <div *ngIf="showEditBoardGameModal" class="modal-overlay" (click)="closeEditBoardGameModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{isMassEditing ? 'Edit Board Game (' + getMassEditProgress().current + ' of ' + getMassEditProgress().total + ')' : 'Edit Board Game'}}</h2>
        <button type="button" class="close-button" (click)="closeEditBoardGameModal()">×</button>
      </div>
      
      <form (ngSubmit)="onSubmitEditBoardGame()" #boardGameForm="ngForm" class="modal-form">
        <div class="form-group">
          <label for="title">Title *</label>
          <app-selectable-text-input
            #titleField
            id="title"
            name="title"
            [(ngModel)]="editBoardGame.title"
            #titleNgModel="ngModel"
            [required]="true"
            [minlength]="1"
            placeholder="">
          </app-selectable-text-input>
          <div *ngIf="titleNgModel.invalid && titleNgModel.touched" class="error-text">
            Title is required
          </div>
        </div>

        <!-- Dynamic Custom Fields -->
        <app-dynamic-custom-fields 
          entityKey="boardGame" 
          sectionTitle=""
          [(customFieldValues)]="editBoardGame.customFieldValues">
        </app-dynamic-custom-fields>

        <div class="modal-actions">
          <button type="button" class="cancel-button" (click)="closeEditBoardGameModal()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="create-button" 
            [disabled]="!boardGameForm.form.valid || isUpdating">
            {{isUpdating ? 'Updating...' : 'Update'}}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Entity Filter Modal -->
  <app-entity-filter-modal
    entityType="boardGame"
    [(show)]="showFilterModal"
    (filtersApplied)="onFiltersApplied($event)">
  </app-entity-filter-modal>
</div>