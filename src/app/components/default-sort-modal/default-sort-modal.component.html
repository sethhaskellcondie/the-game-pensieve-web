<div *ngIf="show" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" [class.dark-mode]="isDarkMode" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Set Default Sort for {{formatEntityName(entityType)}}</h2>
      <button type="button" class="close-button" (click)="closeModal()">Ã—</button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="modal-body loading-state">
      <p>Loading field options...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="modal-body error-state">
      <p class="error-text">{{errorMessage}}</p>
      <button type="button" class="retry-button" (click)="loadFieldOptions()">
        Retry
      </button>
    </div>

    <!-- Sort Form -->
    <div *ngIf="!isLoading && !errorMessage && fieldOptions.length > 0" class="modal-body">
      <form (ngSubmit)="onSubmit()" #sortForm="ngForm">
        <div class="form-group">
          <label for="field">Sort Field *</label>
          <app-filterable-dropdown
            id="field"
            name="field"
            [(ngModel)]="formData.field"
            [options]="fieldOptions"
            placeholder="Select field to sort by"
            [required]="true">
          </app-filterable-dropdown>
        </div>

        <div class="form-group">
          <label for="direction">Sort Direction *</label>
          <app-filterable-dropdown
            id="direction"
            name="direction"
            [(ngModel)]="formData.operand"
            [options]="sortOptions"
            placeholder="Select sort direction"
            [required]="true">
          </app-filterable-dropdown>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-button" (click)="closeModal()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="save-button"
            [disabled]="!sortForm.form.valid || isSubmitting">
            {{isSubmitting ? 'Saving...' : 'Save Default Sort'}}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>