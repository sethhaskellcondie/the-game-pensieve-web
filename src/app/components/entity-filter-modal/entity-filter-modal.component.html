<div *ngIf="show" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content filter-modal" [class.dark-mode]="isDarkMode" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Filter {{formatFieldName(entityType)}}</h2>
      <button type="button" class="close-button" (click)="closeModal()">Ã—</button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="modal-body loading-state">
      <p>Loading filter options...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="modal-body error-state">
      <p class="error-text">{{errorMessage}}</p>
      <button type="button" class="retry-button" (click)="loadFilterSpecification()">
        Retry
      </button>
    </div>

    <!-- Filter Form -->
    <div *ngIf="!isLoading && !errorMessage && filterSpec" class="modal-body">
      <app-filter-criteria
        [entityType]="entityType"
        [initialFilters]="getInitialFilters()"
        [isDarkMode]="isDarkMode"
        (filtersChanged)="onFiltersChanged($event)">
      </app-filter-criteria>
    </div>

    <!-- Modal Actions -->
    <div *ngIf="!isLoading && !errorMessage" class="modal-actions">
      <button type="button" class="cancel-button" (click)="closeModal()">
        Cancel
      </button>
      <button 
        type="button" 
        class="clear-button" 
        (click)="clearFilters()"
        [disabled]="!filterService.hasActiveFilters(entityType)">
        Clear All
      </button>
      <button 
        type="button" 
        class="apply-button" 
        (click)="applyFilters()"
        [disabled]="!canApplyFilters()">
        Apply Filters
      </button>
    </div>
  </div>
</div>